generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum CoinStatus {
  Active
  InActive
}

enum PaymentMethod {
  PrePaid
  CashOnDelivery
  Offline
}

enum Status {
  Delivered
  Pending
}

model User {
  id           String @id @default(uuid())
  firstName    String
  lastName     String
  phone        String @unique
  email        String @unique
  hashPassword String

  wallet Coin[]  @relation("UserWallet")
  orders Order[] @relation("UserOrders")
}

model Agent {
  id           Int     @id @default(autoincrement())
  firstName    String
  lastName     String
  phone        String  @unique
  email        String  @unique
  wallet       Coin[]  @relation("AgentWallet")
  hashPassword String
  orders       Order[] @relation("AgentOrders")
}

model Coin {
  coinId  String @id @default(uuid())
  userId  String
  agentId Int?
  orderId String
  value   Float

  createdOn    DateTime   @default(now())
  transferDate DateTime?
  status       CoinStatus @default(Active)
  user         User?      @relation("UserWallet", fields: [userId], references: [id])
  agent        Agent?     @relation("AgentWallet", fields: [agentId], references: [id])
}

model Item {
  itemId Int    @id @default(autoincrement())
  name   String
  price  Float

  Order Order[] @relation("OrderItems")
}

model Order {
  orderId         String        @id @default(uuid())
  value           Float
  deliveryDate    DateTime
  paymentMode     PaymentMethod
  deliveryStatus  Status        @default(Pending)
  userId          String
  assignedAgentId Int?
  signature       String?

  user          User   @relation("UserOrders", fields: [userId], references: [id])
  assignedAgent Agent? @relation("AgentOrders", fields: [assignedAgentId], references: [id])
  items         Item[] @relation("OrderItems")
}
